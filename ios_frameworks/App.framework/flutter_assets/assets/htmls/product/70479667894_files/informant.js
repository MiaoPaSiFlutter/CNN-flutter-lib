!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.informant=e()}(this,function(){"use strict";function t(t,e){return e={exports:{}},t(e,e.exports),e.exports}function e(t,e){return parseInt(Math.random()*(e-t))+t}function n(t){var e;return e=Array.isArray?Array.isArray(t):function(t){return t instanceof Array}}function o(t){return null==t?String(t):v[b.call(t)]||"object"}function r(t){return null!=t&&t==t.window}function i(t){return"object"==o(t)}function c(t){return i(t)&&!r(t)&&Object.getPrototypeOf(t)==Object.prototype}function u(t,e,o){for(var r in e)o&&(c(e[r])||n(e[r]))?(c(e[r])&&!c(t[r])&&(t[r]={}),n(e[r])&&!n(t[r])&&(t[r]=g),u(t[r],e[r],o)):void 0!==e[r]&&(t[r]=e[r]);return t}function a(t,e){var n=t.pt||{},o=t.rl||[],r=/img|css/i,i=e.idt>0||e.is>0,c=!1;if(i&&o.length>0&&o.forEach(function(t){if(r.test(t.t)&&(t.dbs>e.is||t.d>e.idt))return c=!0,!0}),!c)for(var u in e)if(n[u]>e[u])return c=!0,!0;return c}function f(t){return this.reportURL="https://awcas.jd.com/api/report",this.errorReportUrl="https://awcas.jd.com/api/report/error",this.errorStackReportUrl="https://awcas.jd.com/api/report/error/stack",this.eventList={},this.reportFrequency=0,this.configs={appId:null},this.configs.appId||u(this.configs,t),this.configs.appId?(this.needImg=this.configs.iu||!1,this.needLimit=this.configs.fu&&c(this.configs.th),void this.init()):console.log("缺少appId")}var s="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d=t(function(t,e){!function(e,n){t.exports=n()}(s,function(){function t(t){return new e(t)}function e(t){function o(t){if("pending"===u)return void f.push(t);var e,n="fulfilled"===u?t.onFulfilled:t.onRejected;if(null===n)return n="fulfilled"===u?t.resolve:t.reject,void n(a);try{e=n(a),t.resolve(e)}catch(o){t.reject(o)}}function r(t){if(t&&("object"===("undefined"==typeof t?"undefined":n(t))||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void e.call(t,r,i)}u="fulfilled",a=t,c()}function i(t){if(t&&("object"===("undefined"==typeof t?"undefined":n(t))||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void e.call(newValue,r,i)}u="rejected",a=t,c()}function c(){setTimeout(function(){f.forEach(function(t){o(t)})},0)}var u="pending",a=null,f=[];this.then=function(t,n){return new e(function(e,r){o({onFulfilled:t||null,onRejected:n||null,resolve:e,reject:r})})},this["catch"]=function(t){return new e(function(e,n){o({onFulfilled:null,onRejected:t||null,resolve:e,reject:n})})},t(r,i)}var n="function"==typeof Symbol&&"symbol"==l(Symbol.iterator)?function(t){return"undefined"==typeof t?"undefined":l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":"undefined"==typeof t?"undefined":l(t)};return t})}),p=function(t){return d(function(t,e){var n=window.performance||window.webkitPerformance;if(!n)return e("performance不兼容");var o=n.timing,r=null;r=setInterval(function(){if(0==o.loadEventEnd)return!1;clearInterval(r);var e=o.navigationStart,n={rdt:o.redirectEnd-o.redirectStart||0,dt:o.domainLookupEnd-o.domainLookupStart||0,tt:o.connectEnd-o.connectStart||0,rst:o.responseStart-o.requestStart||0,rpt:o.responseEnd-o.responseStart||0,st:o.responseEnd-e||0,dpt:o.domInteractive-o.domLoading||0,wt:o.domContentLoadedEventEnd-e||0,dlt:o.loadEventEnd-e||0,bt:o.loadEventEnd-o.responseEnd||0};t(n)})})},y=function(){var t=window.performance||window.webkitPerformance;return t&&t.navigation&&t.navigation.type?t.navigation.type:"999"},m=function(t){var e=window.performance||window.webkitPerformance,n=t?/link|script|img|css/i:/link|script/i;if(!e||e&&void 0==performance.getEntries)return!1;var o=e.getEntriesByType("resource"),r=[];return o||o.length?(o.forEach(function(t){if(n.test(t.initiatorType)){var e={n:t.name,m:"GET",t:t.initiatorType,d:t.duration||0,dbs:t.decodedBodySize||0,nhp:t.nextHopProtocol,st:t.startTime||0};r.push(e)}}),r):r},h=t(function(t,e){!function(e,n){t.exports=n()}(s,function(){function t(t){return"function"==typeof t}function e(t){var e;return e=Array.isArray?Array.isArray(t):function(t){return t instanceof Array}}function n(t){return null==t?String(t):f[p.call(t)]||"object"}function o(t){return null!=t&&t==t.window}function r(t){return"object"==n(t)}function i(t){return r(t)&&!o(t)&&Object.getPrototypeOf(t)==Object.prototype}function c(t){return"number"==typeof t.length}function u(t,n,o){for(var r in n)o&&(i(n[r])||e(n[r]))?(i(n[r])&&!i(t[r])&&(t[r]={}),e(n[r])&&!e(t[r])&&(t[r]=d),u(t[r],n[r],o)):void 0!==n[r]&&(t[r]=n[r]);return t}function a(t,e){return e={exports:{}},t(e,e.exports),e.exports}var f={},d=[],p=f.toString;"Boolean Number String Function Array Date RegExp Object Error".split(" ").forEach(function(t,e){f["[object "+t+"]"]=t.toLowerCase()});var y="undefined"!=typeof window?window:"undefined"!=typeof s?s:"undefined"!=typeof self?self:{},m="function"==typeof Symbol&&"symbol"===l(Symbol.iterator)?function(t){return"undefined"==typeof t?"undefined":l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":"undefined"==typeof t?"undefined":l(t)},h=a(function(t,e){!function(e,n){t.exports=n()}(y,function(){function t(t){return new e(t)}function e(t){function o(t){if("pending"===u)return void f.push(t);var e,n="fulfilled"===u?t.onFulfilled:t.onRejected;if(null===n)return n="fulfilled"===u?t.resolve:t.reject,void n(a);try{e=n(a),t.resolve(e)}catch(o){t.reject(o)}}function r(t){if(t&&("object"===("undefined"==typeof t?"undefined":n(t))||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void e.call(t,r,i)}u="fulfilled",a=t,c()}function i(t){if(t&&("object"===("undefined"==typeof t?"undefined":n(t))||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void e.call(newValue,r,i)}u="rejected",a=t,c()}function c(){setTimeout(function(){f.forEach(function(t){o(t)})},0)}var u="pending",a=null,f=[];this.then=function(t,n){return new e(function(e,r){o({onFulfilled:t||null,onRejected:n||null,resolve:e,reject:r})})},this["catch"]=function(t){return new e(function(e,n){o({onFulfilled:null,onRejected:t||null,resolve:e,reject:n})})},t(r,i)}var n="function"==typeof Symbol&&"symbol"==m(Symbol.iterator)?function(t){return"undefined"==typeof t?"undefined":m(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":"undefined"==typeof t?"undefined":m(t)};return t})}),v=function(){function o(){}function r(t){}function a(t){}function f(t,e){var n=e.context;if(e.beforeSend.call(n,t,e)===!1)return!1}function s(t,e,n){var o=n.context,r="success";n.success.call(o,t,r,e),d(r,e,n)}function l(t,e,n,o){var r=o.context;o.error.call(r,n,e,t),d(e,n,o)}function d(t,e,n){var o=n.context;n.complete.call(o,e,t),a(n)}function p(t){t.processData&&t.data&&"string"!=n(t.data)&&(t.data=g(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=m(t.url,t.data),t.data=void 0)}function y(t,e){var n,o;if(c(t)){for(n=0;n<t.length;n++)if(e.call(t[n],n,t[n])===!1)return t}else for(o in t)if(e.call(t[o],o,t[o])===!1)return t;return t}function m(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function v(t,o,r,c){var u,a=e(o),f=i(o);y(o,function(e,o){u=n(o),c&&(e=r?c:c+"["+(f||"object"==n||"array"==n?e:"")+"]"),!c&&a?t.add(o.name,o.value):"array"==u||!r&&"object"==n?v(t,o,r,e):t.add(e,o)})}function g(e,n){var o=[];return o.add=function(e,n){t(n)&&(n=n()),null==n&&(n=""),this.push(F(e)+"="+F(n))},v(o,e,n),o.join("&").replace(/%20/g,"+")}function b(t){return t&&(t=t.split(";",2)[0]),t&&(t==I?"html":t==L?"json":T.test(t)?"script":R.test(t)&&"xml")||"text"}function w(t,e,n,o,r,i){var c={url:e||"",cache:!1,data:n||{},timeout:6e3,success:function(t){r(t)},error:function(t){i(t)}};switch(o&&(c.crossDomain=!0,c.xhrFields={withCredentials:!0}),t){case"GET":c.type="GET";break;case"POST":c.type="POST";break;case"JSONP":c.dataType="jsonp",c.jsonpCallback="success";break;default:c.type="GET"}D(c)}function j(){}var S,x=0,E=window.document,T=/^(?:text|application)\/javascript/i,R=/^(?:text|application)\/xml/i,L="application/json",I="text/html",O=/^\s*$/,k=E.createElement("a");k.href=window.location.href;var A={type:"GET",beforeSend:o,success:o,error:o,complete:o,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:L,xml:"application/xml, text/xml",html:I,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},F=encodeURIComponent,C=function(e){function n(i,f){clearTimeout(r),u.removeEventListener("load",n,!1),u.removeEventListener("error",n,!1),u.parentNode.removeChild(u),"error"!=i.type&&o?s(o[0],p,e):l(null,f||"error",p,e),window[c]=a,o&&t(a)&&a(o[0]),a=o=void 0}if(!("type"in e))return D(e);var o,r,i=e.jsonpCallback,c=(t(i)?i():i)||"jsonp"+ ++x,u=E.createElement("script"),a=window[c],d=function(){},p=function(){};return u.addEventListener("load",n,!1),u.addEventListener("error",n,!1),f(p,e)===!1?(d("abort"),p):(window[c]=function(){o=arguments},u.src=e.url.replace(/\?(.+)=\?/,"?$1="+c),E.head.appendChild(u),e.timeout>0&&(r=setTimeout(function(){d("timeout")},e.timeout)),p)},D=function(t){var e,n,i=u({},t||{});for(var c in A)void 0===i[c]&&(i[c]=A[c]);r(i),i.crossDomain||(e=E.createElement("a"),e.href=i.url,e.href=e.href,i.crossDomain=k.protocol+"//"+k.host!=e.protocol+"//"+e.host),i.url||(i.url=window.location.toString()),(n=i.url.indexOf("#"))>-1&&(i.url=i.url.slice(0,n)),p(i);var a=i.dataType,d=/\?.+=\?/.test(i.url);if(d&&(a="jsonp"),i.cache!==!1&&(t&&t.cache===!0||"script"!=a&&"jsonp"!=a)||(i.url=m(i.url,"_="+Date.now())),"jsonp"==a)return d||(i.url=m(i.url,i.jsonp?i.jsonp+"=?":i.jsonp===!1?"":"callback=?")),C(i);var y,h=i.accepts[a],v={},g=function(t,e){v[t.toLowerCase()]=[t,e]},w=/^([\w-]+:)\/\//.test(i.url)?RegExp.$1:window.location.protocol,j=i.xhr(),x=j.setRequestHeader;if(i.crossDomain||g("X-Requested-With","XMLHttpRequest"),g("Accept",h||"*/*"),(h=i.mimeType||h)&&(h.indexOf(",")>-1&&(h=h.split(",",2)[0]),j.overrideMimeType&&j.overrideMimeType(h)),(i.contentType||i.contentType!==!1&&i.data&&"GET"!=i.type.toUpperCase())&&g("Content-Type",i.contentType||"application/x-www-form-urlencoded"),i.headers)for(S in i.headers)g(S,i.headers[S]);if(j.setRequestHeader=g,j.onreadystatechange=function(){if(4==j.readyState){j.onreadystatechange=o,clearTimeout(y);var t,e=!1;if(j.status>=200&&j.status<300||304==j.status||0==j.status&&"file:"==w){a=a||b(i.mimeType||j.getResponseHeader("content-type")),t=j.responseText;try{"script"==a?(0,eval)(t):"xml"==a?t=j.responseXML:"json"==a&&(t=O.test(t)?null:JSON.parse(t))}catch(n){e=n}e?l(e,"parsererror",j,i):s(t,j,i)}else l(j.statusText||null,j.status?"error":"abort",j,i)}},f(j,i)===!1)return j.abort(),l(null,"abort",j,i,deferred),j;if(i.xhrFields)for(S in i.xhrFields)try{j[S]=i.xhrFields[S]}catch(T){setTimeout(function(){j[S]=i.xhrFields[S]})}var R=!("async"in i)||i.async;j.open(i.type,i.url,R,i.username,i.password);for(S in v)x.apply(j,v[S]);return i.timeout>0&&(y=setTimeout(function(){j.onreadystatechange=o,j.abort(),l(null,"timeout",j,i)},i.timeout)),j.send(i.data?i.data:null),j},M=j.prototype;return M.get=function(t,e,o){var r=e||{},i=o||!1;2==arguments.length&&("object"==n(arguments[1])&&(r=e,i=!1),"boolean"==n(arguments[1])&&(r={},i=e));var c=new h(function(e,n){w("GET",t,r,i,e,n)});return c},M.post=function(t,e,o){var r=e||{},i=o||!1;2==arguments.length&&("object"==n(arguments[1])&&(r=e,i=!1),"boolean"==n(arguments[1])&&(r={},i=e));var c=new h(function(e,n){w("POST",t,r,i,e,n)});return c},M.jsonp=function(t,e,n){var o=e||{},r=n||!1,i=new h(function(e,n){w("JSONP",t,o,r,e,n)});return i},new j}();return v})}),v={},g=[],b=v.toString;"Boolean Number String Function Array Date RegExp Object Error".split(" ").forEach(function(t,e){v["[object "+t+"]"]=t.toLowerCase()});var w,j="1.1.0",S={d:{state:""},rl:[],pt:{},pu:document.referrer&&document.referrer!==location.href?document.referrer:"",u:location.href,et:y()||"999"};try{var x=function(t){return w?w:w=new f(t)}}catch(E){console.log("informant 初始化方法出问题")}var T=f.prototype;return T.init=function(){this.creatSid(),this.creatExtraData(),this.basicReported()},T.basicReported=function(){var t=this,e=this.needImg||this.needLimit;window.addEventListener("load",function(n){p().then(function(n){S.rl=m(e)||[],S.pt=n||{},t.needLimit?a(S,t.configs.th)&&t.sendMeg(t.reportURL,{report:JSON.stringify(S),appId:t.configs.appId,sid:t.sid,version:j}):t.sendMeg(t.reportURL,{report:JSON.stringify(S),appId:t.configs.appId,sid:t.sid,version:j})})["catch"](function(n){S.rl=m(e)||[],S.pt={},t.needLimit?a(S,t.configs.th)&&t.sendMeg(t.reportURL,{report:JSON.stringify(S),appId:t.configs.appId,sid:t.sid,version:j}):t.sendMeg(t.reportURL,{report:JSON.stringify(S),appId:t.configs.appId,sid:t.sid,version:j})})})},T.sendError=function(t){var e={u:location.href||"",l:"",d:"",f:"",e:""};return c(t)?(e=u(e,t),void this.sendMeg(this.errorReportUrl,{report:JSON.stringify({u:e.u,l:e.l,d:e.d,f:e.f,e:e.e}),appId:this.configs.appId,sid:this.sid,version:j})):console.log("不是一个纯对象")},T.sendMeg=function(t,e){var n=e||{};try{h.post(t,n,!0).then(function(t){})["catch"](function(t){console.log(t)})}catch(o){console.log(o)}},T.creatExtraData=function(){this.configs.state&&(S.d.state=this.configs.state)},T.creatSid=function(){var t=e(1e5,99999999),n=(new Date).getTime();this.sid=""+t+n},T.listenerErr=function(){var t=[],e=null,n=this;window.onerror=function(e,n,o,r,i){t.push({m:e,s:n,l:o})},clearTimeout(e),e=setTimeout(function(){t.length>0&&n.sendMeg(n.errorStackReportUrl,{report:JSON.stringify({el:t}),appId:n.configs.appId,sid:n.sid,version:j})},5e3)},T.addError=function(t){},T.removeAll=function(){},T.on=function(t,e){},T.trigger=function(t){},x});